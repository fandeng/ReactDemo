import React,{Component} from 'react';
import {StyleSheet,
	Text,
	ListView,
	View,
	BackAndroid,
TouchableOpacity,
InteractionManager,
} from 'react-native';

import RecipeSection from '../Data/RecipeSection.json';
import HeaderView from '../common/HeaderView';
import Common from '../common/common';

import LoanDetail from '../pages/LoanDetail';
import RepaymentPlan from '../pages/RepaymentPlan';

import REQUEST_JSON from '../Data/Request.json';
var DataRepository = require('../Data/DataRepository');
var repository = new DataRepository();

var REQUEST_URL = 'http://www.zhihu.com/';
// var index=0;
var classList=[0,1,1,0,0,0,0,0,0,1,1,0,0,0,0,1,0,0];
class MyLoan extends Component{
	constructor(props) {
	  super(props);
	  
	  this.state = {
	  	loaded:false,
	  	dataSource:new ListView.DataSource({rowHasChanged:(r1,r2)=> row1 !== row2}),
	  };
	}

	render(){
		if (!this.state.loaded) {
			return this.renderLoadingView();
		}
		return (
			  <View>
			<HeaderView
			 		titleView= {'我的贷款'}
                    leftIcon={'angle-left'}
                    leftIconAction={() => this.props.navigator.pop() }
                    />
			<ListView
				dataSource={this.state.dataSource}
				renderRow={this.renderData.bind(this)}
				initialListSize={10}
				style={{ height: Common.window.height-64}}//减去导航的高度
			/>
  </View>
			);

	}
	componentDidMount(){
		this.request();
		 BackAndroid.addEventListener('hardwareBackPress', () => {
    		this.props.navigator.pop()
     		return true
		});
	}
	renderLoadingView(){
		return (
			<View style={styles.container}>
				<Text>正在加载...</Text>
			</View>
			);
	}
	renderData(data,sectionID, rowID, highlightRow){
		// index++;
		// console.log(index);
		console.log("-----"+sectionID+"------"+rowID+"-----"+highlightRow);
		let styletemp=styles.container;
		let  styleline={height:1,backgroundColor:'#c0c0c0',marginBottom:30};
		if (rowID==0) {
			styletemp=styles.container_frist;
			styleline={height:2,backgroundColor:'#FFFFFF',marginBottom:0};
		}
		// console.log(index+"   index====>"+data.loan_amount);
		return ( <View style={[styletemp]}>
					<View style={styleline}></View>
					<View style={{flex:2,flexDirection:'row',backgroundColor:data.verify_statue == 0 ?'rgba(201.0, 202.0, 203.0, 1.0)':'rgba(198.0, 223.0, 247.0, 1.0)',paddingTop:20}}>
						<View style={{flex:1,flexDirection:'column',alignItems:'center',justifyContent: 'center'}}>
						<View style={{alignItems:'flex-start'}}>
						<Text style={styles.title}>金额 （元）</Text>
						<Text style={styles.title}>{data.loan_amount}</Text>
						</View>
						</View>

						<View style={{flex:1,alignItems:'center',justifyContent: 'center'}}>
						<View style={{alignItems:'flex-start'}}>
						<Text style={styles.title}>审核时间</Text>
						<Text style={styles.title}>{data.verify_time}</Text>
						</View>
						</View>
					</View>
					<View style={{flex:1,backgroundColor:data.verify_statue == 0 ?'rgba(201.0, 202.0, 203.0, 1.0)':'rgba(198.0, 223.0, 247.0, 1.0)'}}>
					<View style={{alignItems:'center',justifyContent: 'center'}}>
						<TouchableOpacity style={data.verify_statue==0 ? styles.button : styles.buttonblue} onPress = {this.onClick.bind(this,data.verify_statue)}>
							<Text style={{textAlign:'center'}}>{data.verify_statue==0 ? '未通过':'已通过'}</Text>
						</TouchableOpacity>
						</View>
					 </View>
					 
				</View>
		);
	}
	requestData(){
		fetch(REQUEST_URL)
			// .then((response)=>response.json())
			.then((responseData)=>{
				this.setState({
					dataSource:this.state.dataSource.cloneWithRows(classList),
					loaded:true,
				})
			})
			.done();
	}

 request() {
        var queryloanlist = REQUEST_JSON.querydictionarydata;
        
        // alert(page);
        
        repository.launchRequest('queryloanlist',queryloanlist).then((responseData) => {
        	console.log('request  response======>'+responseData.response_body.order_list[0].userid);
            this.setState({
					dataSource:this.state.dataSource.cloneWithRows(responseData.response_body.order_list),
					loaded:true,
				})
        }).done();
    }
componentWillUnmount(){
	// index=0;
}
	onClick(data){
		const {navigator}=this.props;
		console.log('info======>'+data);
		InteractionManager.runAfterInteractions(() => {
			if (navigator) {
				console.log('start to go');
				navigator.push({
					name:'贷款详情',
					component:data == 0 ? LoanDetail:RepaymentPlan,
					passProps:{
						info:data,
					}
				})
			}
		});
	}

};

var styles =StyleSheet.create({
	container: {
    flex: 1,
    flexDirection: 'column',
	height:180,
	paddingLeft:20,
	paddingRight:20,
	marginTop:30,

  },
  container_frist: {
    flex: 1,
    flexDirection: 'column',
	height:150,
	paddingLeft:20,
	paddingRight:20,

  },
    button: {
        width: 90,
		height:30,
        backgroundColor: '#FF0000',
        alignItems:'center',justifyContent: 'center',
        borderRadius: 10,		
    },
    buttonblue: {
        width: 90,
		height:30,
        backgroundColor: '#00BFFF',
        alignItems:'center',justifyContent: 'center',
        borderRadius: 10,

		
    },
  rightContainer: {
    flex: 3,
  },
  title: {
    fontSize: 20,
    marginBottom: 8,
    textAlign: 'left',
  },
  year: {
    textAlign: 'center',
  },
  thumbnail: {
    width: 53,
    height: 81,
  },
  listView: {
    paddingTop: 20,
    backgroundColor: '#F5FCFF',
  },
});
module.exports = MyLoan;
