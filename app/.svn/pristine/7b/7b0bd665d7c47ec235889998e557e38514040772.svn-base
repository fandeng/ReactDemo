//拍照认证
import React, { Component } from 'react';
import {
  StyleSheet,
  Text,
  View,
  PixelRatio,
  TouchableOpacity,
  InteractionManager,
  Image,
  Platform,
  ScrollView,
  Dimensions,
} from 'react-native';

import ImagePicker from 'react-native-image-picker';
import Common from '../common/common';

var photoArray = [require('../img/updown.png'),require('../img/updown.png'),require('../img/updown.png'),require('../img/updown.png'),require('../img/updown.png')];

class PhotographCertificateContainer extends Component {
  state = {
    personalSource: null,
    cardYSource:null,
    cardNSource:null,
    workYSource:null,
    workNSource:null
  };
  selectPhotoTapped(item) {
    const options = {
      title: '', // 选择器的标题，可以设置为空来不显示标题
      cancelButtonTitle: '取消',
      takePhotoButtonTitle: '拍照', // 调取摄像头的按钮，可以设置为空使用户不可选择拍照
      chooseFromLibraryButtonTitle: '从手机相册选择', // 调取相册的按钮，可以设置为空使用户不可选择相册照片
      mediaType: 'photo',//类型
      quality: 1.0,//质量
      maxWidth: Common.window.width-40,// photos only默认为手机屏幕的宽，高与宽一样，为正方形照片
      maxHeight: 100,
      storageOptions: {
        skipBackup: true
      }
    };
    ImagePicker.showImagePicker(options, (response) => {
        console.log('Response = ', response);
        if (response.didCancel) {
          console.log('User cancelled photo picker');
        } else if (response.error) {
          console.log('ImagePicker Error: ', response.error);
        } else if (response.customButton) {
          console.log('User tapped custom button: ', response.customButton);
        } else {
          var source;
          if (Platform.OS === 'android') {
            source = {uri: response.uri, isStatic: true};
          } else {
            source = {uri: response.uri.replace('file://', ''), isStatic: true};
          }
          if (item == 0) {
            photoArray[0] = source
          } else if (item == 1) {
            photoArray[1]=source
          } else if (item == 2) {
            photoArray[2]=source
          } else if (item == 3) {
            photoArray[3]=source
          } else {
            photoArray[4]=source
          }
          this.setState({
            personalSource:photoArray[0],
            cardYSource:photoArray[1],
            cardNSource:photoArray[2],
            workYSource:photoArray[3],
            workNSource:photoArray[4]
        });
        }
     });
  }
  render() {
    return (
      <View>
          <ScrollView scrollEnabled={false} style={{backgroundColor:'#f0f1f2',width:Common.window.width}}>
              <View style={styles.container}>
                  <Text numberOfLines={2} style= {styles.promte_style}>1、两步拍照，证明自己是自己，请保证背景为纯色，五官清晰无遮挡。</Text>
                  <View style={styles.cardBack_style}>
                      <TouchableOpacity onPress={this.selectPhotoTapped.bind(this,0)}>
                        { this.state.personalSource === null ? <Image style={styles.updownDefault_style} source={require('../img/updown.png')} />:
                          <Image style={styles.updownDefault_style} source={this.state.personalSource} />
                        }
                      </TouchableOpacity>
                      <Image style={styles.updownDefault_style} source={require('../img/progress.png')} />
                  </View>
                  <View style={styles.contentBack_style}>
                     <Text style= {styles.content_style}>个人拿着身份证</Text>
                     <Text style= {styles.content_style}>比如：这样的</Text>
                  </View>
              </View>
              <View style={{height:10,backgroundColor:'#f0f1f2'}}/>
              <View style={styles.container}>
                  <Text numberOfLines={2} style= {styles.promte_style}>2、身份证照需拍摄两张，分别为正面和反面。</Text>
                  <View style={styles.cardBack_style}>
                    <TouchableOpacity onPress={this.selectPhotoTapped.bind(this,1)}>
                      { this.state.cardYSource === null ? <Image style={styles.updownDefault_style} source={require('../img/updown.png')} />:
                        <Image style={styles.updownDefault_style} source={this.state.cardYSource} />
                      }
                    </TouchableOpacity>
                    <TouchableOpacity onPress={this.selectPhotoTapped.bind(this,2)}>
                      { this.state.cardNSource === null ? <Image style={styles.updownDefault_style} source={require('../img/updown.png')} />:
                        <Image style={styles.updownDefault_style} source={this.state.cardNSource} />
                      }
                    </TouchableOpacity>
                  </View>
                  <View style={styles.contentBack_style}>
                     <Text style= {styles.content_style}>身份证正面</Text>
                     <Text style= {styles.content_style}>身份证反面</Text>
                  </View>
              </View>
              <View style={styles.container}>
                  <Text numberOfLines={2} style= {styles.promte_style}>3、工作正面可为盖有公章的工作证明原件。</Text>
                  <View style={styles.cardBack_style}>
                    <TouchableOpacity onPress={this.selectPhotoTapped.bind(this,3)}>
                      { this.state.workYSource === null ? <Image style={styles.updownDefault_style} source={require('../img/updown.png')} />:
                        <Image style={styles.updownDefault_style} source={this.state.workYSource} />
                      }
                    </TouchableOpacity>
                    <TouchableOpacity onPress={this.selectPhotoTapped.bind(this,4)}>
                      { this.state.workNSource === null ? <Image style={styles.updownDefault_style} source={require('../img/updown.png')} />:
                        <Image style={styles.updownDefault_style} source={this.state.workNSource} />
                      }
                    </TouchableOpacity>
                  </View>
                  <View style={styles.contentBack_style}>
                      <Text style= {styles.content_style}>工作证明正面</Text>
                      <Text style= {styles.content_style}>工作证明反面</Text>
                  </View>
              </View>
          </ScrollView>
      </View>
    );
  }
   //添加联系人点击事件
  /*_onPressFeedItem() {
      InteractionManager.runAfterInteractions(() => {
        let uri = "file:///Users/fandeng/Library/Developer/CoreSimulator/Devices/7A510737-4D75-447F-A20E-EFEFF088DC60/data/Containers/Data/Application/88F20342-2DE2-49F6-8B4F-806AE36E8C8D/Documents/68F6FBED-3994-4A7B-8092-5F8B1492C1EE.jpg";
        let formData = new FormData();
        let file = {uri: uri, type: 'multipart/form-data', name: 'a.jpg'};

        formData.append("images",file);

        let url = "http://112.74.205.50/babylove-web/upFile.servlet";
        fetch(url,{
            method:'POST',
            headers:{
                'Accept': 'text/html;charset=UTF-8',
                'Content-Type':'multipart/form-data',
                'fileName':'image.png',
                'phonetype':'ios',
                'fileType':'9001'
            },
            body:formData,
        }) .then(
            (response) => {
                 alert(response.headers.map.attachmentid);
             }
            )
            .catch((error)=>{console.error('error',error)});
      });
  }*/

}

const styles = StyleSheet.create({
  container: {
    height:200,
    width:Common.window.width,
    alignItems: 'center',
    backgroundColor: 'white'
  },
  promte_style:{
    marginTop:15,
    marginLeft:10,
    width:Common.window.width-20,
    fontSize:14,
    color:'#999999',
    textAlign:'left'
  },
  updownDefault_style: {
    width:90,
    height:90
  },
  updownPhoto_style: {
    width: Common.window.width-40,
    height: 100
  },
  content_style:{
    marginTop:15,
    width:120,
    fontSize:13,
    color:'#999999',
    textAlign:'center'
  },
  cardBack_style:{
    marginLeft:10,
    marginTop:20,
    width:Common.window.width-20,
    alignItems:'center',
    justifyContent:'space-around',
    flexDirection: 'row',
  },
  contentBack_style:{
    marginLeft:10,
    width:Common.window.width-20,
    alignItems:'center',
    justifyContent:'space-around',
    flexDirection: 'row',
  },
});

module.exports = PhotographCertificateContainer;
