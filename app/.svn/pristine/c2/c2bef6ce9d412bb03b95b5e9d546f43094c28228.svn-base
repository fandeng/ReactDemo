//添加银行卡界面
//'use strict'
import React, { Component } from 'react';
import {
    StyleSheet,
    Text,
    TextInput,
    ScrollView,
    View,
    InteractionManager,
} from 'react-native';

import Common from '../common/common';
import HeaderView from '../common/HeaderView';
import Style from '../style/style';
import InformationProgressContainer from '../components/InformationProgress'

import ResponseData from '../Data/Response.json';
import REQUEST_JSON from '../Data/Request.json';
var DataRepository = require('../Data/DataRepository');
var repository = new DataRepository();
import { toastShort } from '../utils/ToastUtil';
import RCTDeviceEventEmitter from 'RCTDeviceEventEmitter'

let bankname;
let bankcard;
class AddBankCardContainer extends Component {
    constructor(props) {
  	  super(props);
  	  this.state = {
  	  	info:this.props.info,
  	  };
  	}
    render() {
        return (
          <View>
            <HeaderView  titleView= {'添加银行卡'}
              leftIcon={'angle-left'}
              leftIconAction={() => this.props.navigator.pop() }
              rightButton={'完成'}
              collectIconAction={() => this.onPressHandler() }/>
              <ScrollView scrollEnabled={false} style={{backgroundColor:'#f0f1f2', height: Common.window.height-64,width:Common.window.width}}>
                  {this.props.info == 1?null:<InformationProgressContainer numSign = {1}  image = {['1','1','1','0']} progressArray={['个人信息','紧急联系人', '拍照认证','添加银行卡']}/>}
                  <View style={{height:15,alignItems: 'center'}}/>
                  <View  style={{height:55,alignItems: 'center',backgroundColor:'white'}}>
                      <View style={{height:54,alignItems: 'center',flexDirection: 'row',backgroundColor:'white'}}>
                          <Text style={[Style.mainBody,{marginLeft:10,height:20,marginTop:8,width:80}]}>开户行</Text>
                          <TextInput
                            style={Style.text_input}
                            placeholder='请输入开户行'
                            numberOfLines={1}
                            autoFocus={false}
                            textAlign='right'
                            underlineColorAndroid={'transparent'}
                            onChangeText={(text) => {
                                bankname = text;
                            }}
                          />
                    </View>
                    <View style={{height:1,backgroundColor:'white'}}>
                          <View style={{height:1,backgroundColor:'#f4f4f4',marginLeft:10,width:Common.window.width-10}}/>
                    </View>
                  </View>

                  <View  style={{height:55,alignItems: 'center',backgroundColor:'white'}}>
                      <View style={{height:54,alignItems: 'center',flexDirection: 'row',backgroundColor:'white'}}>
                          <Text style={[Style.mainBody,{marginLeft:10,height:20,marginTop:8,width:80}]}>银行卡号</Text>
                          <TextInput
                            style={Style.text_input}
                            placeholder='请输入银行卡号'
                            numberOfLines={1}
                            autoFocus={false}
                            textAlign='right'
                            keyboardType='numeric'
                            underlineColorAndroid={'transparent'}
                            onChangeText={(text) => {
                                bankcard = text;
                            }}
                          />
                    </View>
                    <View style={{height:1,backgroundColor:'white'}}>
                          <View style={{height:1,backgroundColor:'#f4f4f4',marginLeft:10,width:Common.window.width-10}}/>
                    </View>
                  </View>
              </ScrollView>
          </View>
      );
    }
    onPressHandler = () => {
        InteractionManager.runAfterInteractions(() => {
            if (bankname == undefined) {
              toastShort('请输入开户行');
            } else if (bankcard ==undefined) {
              toastShort('请输入银行卡号');
            } else if (this.isCardNum(bankcard)) {
              toastShort('请输入正确的银行卡号');
            }else {
              this.request();
            }
        });
    }
    request() {
        var modifyuserinfo = REQUEST_JSON.modifyuserinfo;
        modifyuserinfo.userid = '123';
        let cards = {bank_card_num: bankcard, bank: bankname}
        modifyuserinfo.bank_cards = [cards];
        repository.launchRequest('modifyuserinfo',modifyuserinfo).then((responseData) => {
            this.props.info==0?this.props.navigator.popToTop():this.props.navigator.pop()
            RCTDeviceEventEmitter.emit('isRefresh',{'bank_card_num':bankcard,'bank':bankname})
        }).done();
    }
    isCardNum(str){
      var regu='^(\\d{16}|\\d{19})$';
      var re = new RegExp(regu);
      return !re.test(str);
    }
}

module.exports = AddBankCardContainer;
