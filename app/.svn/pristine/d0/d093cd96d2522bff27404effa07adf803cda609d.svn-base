import React,{Component} from 'react';
import {StyleSheet,
	Text,
	ListView,
	View,
	Image,
	BackAndroid,
TouchableOpacity,
InteractionManager,
} from 'react-native';

import RecipeSection from '../Data/RecipeSection.json';
import HeaderView from '../common/HeaderView';
import Common from '../common/common';

import LoanDetail from '../pages/LoanDetail';
import RepaymentPlan from '../pages/RepaymentPlan';

import REQUEST_JSON from '../Data/Request.json';
var DataRepository = require('../Data/DataRepository');
var repository = new DataRepository();

var REQUEST_URL = 'http://www.zhihu.com/';
// var index=0;
var classList=[0,1,1,0,0,0,0,0,0,1,1,0,0,0,0,1,0,0];

var thisPage=1;
var Count=0;
class MyLoan extends Component{
	constructor(props) {
	  super(props);
	  
	  this.state = {
	  	loaded:false,
	  	dataSource:new ListView.DataSource({rowHasChanged:(r1,r2)=> row1 !== row2}),
	  };
	}

	render(){
		if (!this.state.loaded) {
			return this.renderLoadingView();
		}
		return (
			  <View style={{backgroundColor:'#F0F1F2'}}>
			<HeaderView
			 		titleView= {'我的贷款'}
                    leftIcon={'angle-left'}
                    leftIconAction={() => this.props.navigator.pop() }
                    />
			<ListView
				dataSource={this.state.dataSource}
				renderRow={this.renderData.bind(this)}
				onEndReached={this.loadmore.bind(this)}
				initialListSize={10}
				style={{ height: Common.window.height-64,}}//减去导航的高度
			/>
  </View>
			);

	}
	componentDidMount(){
		this.request(thisPage);
		 BackAndroid.addEventListener('hardwareBackPress', () => {
    		this.props.navigator.pop()
     		return true
		});
	}
	renderLoadingView(){
		return (
			<View style={styles.container}>
				<Text>正在加载...</Text>
			</View>
			);
	}
	renderData(data,sectionID, rowID, highlightRow){
		var temp=(Number)(rowID)+1;
		console.log((temp/20)+"-----"+sectionID+"------"+rowID+"-----"+highlightRow);
		count=parseInt((Number)(rowID)+1);

		return ( 
					<TouchableOpacity style={styles.container} onPress = {this.onClick.bind(this,data)}>
					<View style={{flex:1,flexDirection:'row',alignItems:'center',justifyContent: 'center'}} >
						

						<View style={{flex:1,flexDirection:'row',alignItems:'center',justifyContent: 'center'}}>
							<View style={{flex:1,flexDirection:'row',alignItems:'center',justifyContent: 'center'}}>
							<Image style={{flex:1}} source={data.verify_statue==0 ? require('../img/left_gray_line.png'):require('../img/left_blue_line.png')}>
							</Image>
							</View>
								<Text style={{ fontSize: 24, textAlign: 'center',marginLeft:10,marginRight:10,fontSize: 16,color:data.verify_statue==0 ? '#999999':'#1a98ff'}}>{data.verify_statue==0 ? '未通过':'已通过'}</Text>
							<View style={{flex:1,flexDirection:'row',alignItems:'center',justifyContent: 'center'}}>
							<Image style={{flex:1}} source={data.verify_statue==0 ? require('../img/right_gray_line.png'):require('../img/right_blue_line.png')}>
							</Image>
							</View>
						</View>

					
					</View>
					
					<View style={{flex:2,flexDirection:'row'}}>
						<View style={{flex:1,flexDirection:'column',alignItems:'center',justifyContent: 'center'}}>
							<View style={{alignItems:'center'}}>
								<Text style={[styles.title,{color:'#1a98ff'}]}>{data.loan_amount}</Text>
								<Text style={styles.title_text}>金额（元）</Text>
							</View>
						</View>
						
						<View style={[styles.line_style,{marginBottom:15,marginTop:10}]}></View>

						<View style={{flex:1,alignItems:'center',justifyContent: 'center'}}>
							<View style={{alignItems:'center'}}>
								<Text style={[styles.title,{color:'#1a98ff'}]}>{data.verify_time}</Text>
								<Text style={styles.title_text}>审核时间</Text>
							</View>
						</View>

					</View>
					 </TouchableOpacity>
					 
				
		);
	}

loadmore(){
		console.log("thispage====>"+thisPage+"----count======>"+count);
}
 request() {
        var queryloanlist = REQUEST_JSON.querydictionarydata;
        
        // alert(page);
        
        repository.launchRequest('queryloanlist',queryloanlist).then((responseData) => {
        	console.log('request  response======>'+responseData.response_body.order_list[0].userid);
            this.setState({
					dataSource:this.state.dataSource.cloneWithRows(responseData.response_body.order_list),
					loaded:true,
				})
        }).done();
    }
componentWillUnmount(){
	// index=0;
}
	onClick(data){
		const {navigator}=this.props;
		console.log('info======>'+data.verify_statue);
		InteractionManager.runAfterInteractions(() => {
			if (navigator) {
				console.log('start to go');
				navigator.push({
					name:'贷款详情',
					component:data.verify_statue == 0 ? LoanDetail:RepaymentPlan,
					passProps:{
						info:data.verify_statue,
						id:data.userid,
					}
				})
			}
		});
	}

};

var styles =StyleSheet.create({
	container: {
    flex: 1,
    flexDirection: 'column',
	height:180,
	paddingLeft:20,
	paddingRight:20,
	marginTop:20,
	backgroundColor:"#ffffff",
	marginLeft:20,
	marginRight:20,
	borderRadius:5,

  },
  container_frist: {
    flex: 1,
    flexDirection: 'column',
	height:150,
	paddingLeft:20,
	paddingRight:20,

  },
    button: {
        width: 90,
		height:30,
        backgroundColor: '#FF0000',
        alignItems:'center',justifyContent: 'center',
        borderRadius: 10,		
    },
    buttonblue: {
        width: 90,
		height:30,
        backgroundColor: '#00BFFF',
        alignItems:'center',justifyContent: 'center',
        borderRadius: 10,

		
    },
  rightContainer: {
    flex: 3,
  },
  title: {
    fontSize: 24,
    marginBottom: 20,
    textAlign: 'center',
  },
  title_text: {
    fontSize: 16,
	marginBottom:20,
    textAlign: 'center',
    color:'#666666',
  },
  year: {
    textAlign: 'center',
  },
  thumbnail: {
    width: 53,
    height: 81,
  },
  listView: {
    paddingTop: 20,
    backgroundColor: '#F5FCFF',
  },
   line_style:{width:1,backgroundColor:'#D3D3D3',alignItems:'center'},
});
module.exports = MyLoan;
