//单位信息界面
import React, { Component } from 'react';
import  {
  AppRegistry,
  StyleSheet,
  Text,
  View,
  ScrollView,
  Dimensions,
  InteractionManager
} from 'react-native';

import Common from '../common/common';
import HeaderView from '../common/HeaderView';

import UnitsInformationContainer from '../components/UnitsInformation';
import ResponseData from '../Data/Response.json';
import REQUEST_JSON from '../Data/Request.json';
var DataRepository = require('../Data/DataRepository');
var repository = new DataRepository();
import { toastShort } from '../utils/ToastUtil';

class UnitsInformationVC extends Component {
  state = {
      data: []
  }
  _callUnitsback(dataArray) {
    this.setState({
        data: dataArray,
    });
    console.log(dataArray);
  }
  render() {
    return (
      <View>
        <HeaderView  titleView= {'单位信息'}
        leftIcon={'angle-left'}
        leftIconAction={() => this.props.navigator.pop() }
        rightButton={'确认'}
        collectIconAction={() => this.onPressHandler()}/>
        {
          <ScrollView style={{backgroundColor:'#f0f1f2',height: Common.window.height-64,width:Common.window.width}}>
             <UnitsInformationContainer callUnitsback={this._callUnitsback.bind(this)}/>
          </ScrollView>
        }
      </View>
    );
  }
  onPressHandler = () => {
      InteractionManager.runAfterInteractions(() => {
          if (this.state.data[0] ==undefined) {
            toastShort('请输入工作单位');
          } else if (this.state.data[1] ==undefined) {
            toastShort('请输入办公电话');
          } else if (this.state.data[2] ==undefined) {
            toastShort('请输入办公地址');
          } else {
            this.request();
          }
      });
  }
  request() {
      var modifyuserinfo = REQUEST_JSON.modifyuserinfo;
      modifyuserinfo.userid = '123';
      modifyuserinfo.employer = this.state.data[0];
      modifyuserinfo.office_phone = this.state.data[1];
      modifyuserinfo.office_address = this.state.data[2];
      repository.launchRequest('modifyuserinfo',modifyuserinfo).then((responseData) => {
          alert(responseData.retinfo.retmsg)
          this.props.navigator.pop()
      }).done();
  }
}


module.exports = UnitsInformationVC;
